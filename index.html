<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Creative Archive v7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 기본 스타일 및 터치 오류 방지 */
        body { font-family: 'Inter', sans-serif; overflow: hidden; margin: 0; background-color: #f9fafb; color: #18181b; -webkit-tap-highlight-color: transparent; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .noselect { -webkit-user-select: none; user-select: none; }
        
        /* 탭 스타일 */
        .tab-btn { padding: 8px 16px; font-family: 'Playfair Display', serif; font-style: italic; font-size: 16px; color: #9ca3af; transition: 0.2s; }
        .tab-btn.active { color: #000; font-weight: 700; border-bottom: 2px solid #000; }
        
        /* 모달 애니메이션 및 Z-Index */
        .modal { transition: opacity 0.2s, visibility 0.2s; z-index: 500; }
        .modal.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .modal:not(.hidden) { opacity: 1; visibility: visible; pointer-events: auto; }
        
        /* 이미지 비율 유틸리티 */
        .img-contain { object-fit: contain; background-color: #e5e7eb; } /* gray-200 */
        .img-cover { object-fit: cover; }
    </style>
</head>
<body class="h-screen w-screen flex flex-col">

    <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-4 z-50 flex-shrink-0">
        <div class="flex items-center gap-2">
            <button onclick="changeTab('scraps')" id="tab-scraps" class="tab-btn active">Scraps</button>
            <button onclick="changeTab('folders')" id="tab-folders" class="tab-btn">Folders</button>
            <button onclick="changeTab('favorites')" id="tab-favorites" class="tab-btn">Favs</button>
        </div>
        
        <div class="flex items-center gap-3">
            <button onclick="openModal('settings-modal')" class="w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-gray-200 active:scale-95 transition">
                <i data-lucide="settings" class="w-5 h-5"></i>
            </button>
            <button onclick="openModal('add-modal')" class="w-9 h-9 rounded-full bg-black flex items-center justify-center text-white shadow-lg hover:bg-gray-800 active:scale-95 transition">
                <i data-lucide="plus" class="w-5 h-5"></i>
            </button>
        </div>
    </header>

    <main class="flex-grow relative bg-[#fafafa] overflow-hidden">
        <div class="absolute top-0 left-0 right-0 p-4 z-40 bg-white/80 backdrop-blur-sm border-b border-gray-100">
            <div class="relative">
                <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-gray-400"></i>
                <input type="text" id="search-input" oninput="render()" placeholder="Search..." class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm outline-none focus:border-black transition">
            </div>
        </div>

        <div class="absolute inset-0 pt-20 pb-10 px-4 overflow-y-auto no-scrollbar">
            
            <div id="view-scraps" class="grid grid-cols-2 md:grid-cols-4 gap-4 pb-20"></div>
            
            <div id="view-folders" class="hidden grid grid-cols-2 md:grid-cols-4 gap-4 pb-20">
                <button onclick="openModal('folder-modal')" class="flex flex-col items-center justify-center aspect-square bg-white border-2 border-dashed border-gray-300 rounded-lg text-gray-400 hover:border-black hover:text-black transition">
                    <i data-lucide="folder-plus" class="w-8 h-8 mb-2"></i>
                    <span class="text-xs font-bold">New Folder</span>
                </button>
                <div id="folder-list-container" class="contents"></div>
            </div>

            <div id="empty-state" class="hidden absolute inset-0 flex flex-col items-center justify-center text-gray-400 pb-20 pointer-events-none">
                <i data-lucide="box" class="w-12 h-12 mb-3 opacity-20"></i>
                <p class="text-xs font-bold tracking-widest uppercase">No Items Found</p>
            </div>
        </div>
    </main>

    <div id="add-modal" class="modal fixed inset-0 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeModal('add-modal')"></div>
        <div class="absolute right-0 top-0 h-full w-full md:w-[450px] bg-white shadow-2xl flex flex-col transition-transform duration-300 transform translate-x-0">
            <div class="p-5 border-b flex justify-between items-center bg-white">
                <h2 class="font-serif italic text-2xl">New Scrap</h2>
                <button onclick="closeModal('add-modal')"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div class="flex-grow overflow-y-auto p-6 space-y-6">
                <div>
                    <label class="text-xs font-bold text-gray-400 mb-1 block">LINK</label>
                    <div class="flex gap-2">
                        <input type="url" id="inp-url" class="flex-1 border p-2 rounded text-sm" placeholder="Paste URL...">
                        <button onclick="processUrl()" class="bg-black text-white px-3 text-xs font-bold rounded">CHECK</button>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400 mb-1 block">THUMBNAIL</label>
                    <div class="flex gap-3">
                        <div class="w-20 h-20 bg-gray-100 rounded border overflow-hidden">
                            <img id="inp-preview" class="w-full h-full object-cover hidden">
                        </div>
                        <div class="flex-1 space-y-2">
                            <input type="text" id="inp-img" class="w-full border p-2 rounded text-xs" placeholder="Image URL" oninput="updatePreview(this.value)">
                            <input type="file" id="inp-file" class="hidden" onchange="handleFileSelect(event)">
                            <button onclick="document.getElementById('inp-file').click()" class="bg-gray-100 border px-3 py-1 rounded text-xs">Upload File</button>
                        </div>
                    </div>
                </div>
                <input type="text" id="inp-title" class="w-full border-b py-2 text-lg font-bold outline-none" placeholder="Title">
                <div class="flex gap-3">
                    <select id="inp-type" class="w-1/2 border-b py-2 text-sm bg-transparent">
                        <option value="news">Article</option>
                        <option value="video">Video</option>
                        <option value="image">Image</option>
                        <option value="paper">Paper</option>
                    </select>
                    <input type="text" id="inp-folder" class="w-1/2 border-b py-2 text-sm" placeholder="Folder Name" list="dl-folders">
                    <datalist id="dl-folders"></datalist>
                </div>
                <textarea id="inp-memo" rows="3" class="w-full bg-yellow-50 p-3 rounded text-sm" placeholder="Memo..."></textarea>
            </div>
            <div class="p-5 border-t">
                <button onclick="saveNewItem()" class="w-full bg-black text-white py-4 rounded font-bold">SAVE</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal fixed inset-0 hidden flex items-center justify-center px-6">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeModal('settings-modal')"></div>
        <div class="bg-white w-full max-w-sm rounded-xl p-6 relative z-10 shadow-2xl">
            <h3 class="font-serif italic text-2xl mb-6">Settings</h3>
            <div class="space-y-3">
                <button onclick="exportData()" class="w-full p-4 bg-gray-50 border rounded-lg flex items-center gap-3 font-bold text-sm hover:bg-gray-100">
                    <i data-lucide="download" class="w-5 h-5"></i> Backup Data (Download)
                </button>
                <div class="relative">
                    <input type="file" id="import-file" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept=".json" onchange="importData(event)">
                    <button class="w-full p-4 bg-black text-white rounded-lg flex items-center gap-3 font-bold text-sm hover:bg-gray-800">
                        <i data-lucide="upload" class="w-5 h-5"></i> Restore Data (Upload)
                    </button>
                </div>
                <button onclick="resetAllData()" class="w-full p-4 text-red-500 font-bold text-xs mt-4">RESET ALL DATA</button>
            </div>
        </div>
    </div>

    <div id="detail-modal" class="modal fixed inset-0 hidden bg-white flex flex-col z-[600]">
        <div class="h-16 px-4 border-b flex justify-between items-center bg-white flex-shrink-0">
            <button onclick="closeModal('detail-modal')"><i data-lucide="arrow-left" class="w-6 h-6"></i></button>
            <button onclick="openTypeChange()" id="dt-badge" class="px-3 py-1 bg-gray-100 rounded-full text-xs font-bold flex items-center gap-1">ITEM <i data-lucide="chevron-down" class="w-3 h-3"></i></button>
            <div class="w-6"></div>
        </div>
        <div class="flex-grow overflow-y-auto p-6 custom-scrollbar">
            <div class="max-w-3xl mx-auto space-y-6">
                <input type="text" id="dt-title" class="w-full text-center font-serif italic text-3xl outline-none bg-transparent border-b border-transparent focus:border-gray-200 transition p-2" onchange="updateTitle(this.value)">
                
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="w-full md:w-1/2 bg-gray-200 rounded-lg overflow-hidden relative aspect-video group">
                        <a id="dt-link" href="#" target="_blank" class="block w-full h-full">
                            <img id="dt-img" class="w-full h-full img-contain" src="">
                        </a>
                        <button onclick="toggleFit()" class="absolute bottom-2 right-2 bg-black/50 text-white p-2 rounded-full hover:bg-black"><i data-lucide="maximize" class="w-4 h-4"></i></button>
                    </div>
                    <div class="w-full md:w-1/2 flex flex-col gap-4">
                        <div class="bg-yellow-50 p-4 rounded border border-yellow-100 flex-grow">
                            <div class="text-xs font-bold text-yellow-600 mb-2">MEMO</div>
                            <textarea id="dt-memo" class="w-full h-full bg-transparent resize-none outline-none text-sm" onchange="updateMemo(this.value)"></textarea>
                        </div>
                        <button onclick="deleteCurrentItem()" class="text-red-500 text-xs font-bold text-right">DELETE ITEM</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="type-modal" class="modal fixed inset-0 hidden flex items-center justify-center bg-black/20 z-[700]">
        <div class="bg-white p-4 rounded-lg shadow-xl grid grid-cols-2 gap-2 w-64">
            <button onclick="changeType('video')" class="p-2 border rounded hover:bg-gray-50">Video</button>
            <button onclick="changeType('news')" class="p-2 border rounded hover:bg-gray-50">Article</button>
            <button onclick="changeType('image')" class="p-2 border rounded hover:bg-gray-50">Image</button>
            <button onclick="changeType('paper')" class="p-2 border rounded hover:bg-gray-50">Paper</button>
            <button onclick="closeModal('type-modal')" class="col-span-2 text-xs text-gray-400 mt-2">CANCEL</button>
        </div>
    </div>

    <div id="folder-modal" class="modal fixed inset-0 hidden flex items-center justify-center bg-black/40">
        <div class="bg-white p-6 rounded-lg w-80 shadow-xl">
            <h3 class="text-xl font-serif italic mb-4">New Folder</h3>
            <input type="text" id="new-folder-name" class="w-full border p-3 rounded mb-4 text-sm" placeholder="Folder Name">
            <button onclick="addFolder()" class="w-full bg-black text-white py-3 rounded font-bold">CREATE</button>
            <button onclick="closeModal('folder-modal')" class="w-full mt-3 text-xs text-gray-400 font-bold">CANCEL</button>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let DATA = { scraps: [], folders: ['General', 'Ideas'] };
        let currentTab = 'scraps';
        let currentItem = null;

        // --- INIT ---
        window.addEventListener('DOMContentLoaded', () => {
            loadData();
            lucide.createIcons();
        });

        // --- DATA MGMT ---
        function loadData() {
            const saved = localStorage.getItem('ARCHIVE_DB');
            if (saved) {
                try {
                    DATA = JSON.parse(saved);
                    // Old Data Migration / Fix
                    if (!DATA.folders) DATA.folders = ['General'];
                    DATA.scraps.forEach(s => {
                        // Fix YouTube Thumbs automatically
                        if (s.type === 'video' && s.img && s.img.includes('hqdefault.jpg')) {
                            s.img = s.img.replace('hqdefault.jpg', 'mqdefault.jpg');
                        }
                    });
                } catch(e) { console.error('Data corrupted, reset'); }
            }
            render();
        }

        function saveData() {
            localStorage.setItem('ARCHIVE_DB', JSON.stringify(DATA));
            render();
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(DATA)], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `archive_backup_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
        }

        function importData(e) {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                try {
                    DATA = JSON.parse(ev.target.result);
                    saveData();
                    alert('Data Restored!');
                    closeModal('settings-modal');
                } catch(err) { alert('Invalid File'); }
            };
            reader.readAsText(file);
        }

        function resetAllData() {
            if(confirm('Really delete EVERYTHING?')) {
                localStorage.removeItem('ARCHIVE_DB');
                location.reload();
            }
        }

        // --- UI RENDER ---
        function changeTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            document.getElementById('view-scraps').classList.add('hidden');
            document.getElementById('view-folders').classList.add('hidden');
            
            if (tab === 'folders') {
                document.getElementById('view-folders').classList.remove('hidden');
            } else {
                document.getElementById('view-scraps').classList.remove('hidden');
            }
            render();
        }

        function render() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const grid = document.getElementById('view-scraps');
            grid.innerHTML = '';
            
            let list = DATA.scraps;
            if (currentTab === 'favorites') list = list.filter(i => i.fav);
            if (search) list = list.filter(i => i.title.toLowerCase().includes(search));

            if (list.length === 0 && currentTab !== 'folders') {
                document.getElementById('empty-state').classList.remove('hidden');
            } else {
                document.getElementById('empty-state').classList.add('hidden');
                list.forEach(item => {
                    // Card HTML
                    const div = document.createElement('div');
                    div.className = "bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden cursor-pointer group relative";
                    div.onclick = () => openDetail(item.id);
                    
                    // Image Area (Gray background + Contain)
                    const imgHtml = item.img 
                        ? `<img src="${item.img}" class="w-full h-full object-contain bg-gray-200" loading="lazy">` 
                        : `<div class="w-full h-full bg-gray-100 flex items-center justify-center text-gray-300"><i data-lucide="image"></i></div>`;
                    
                    div.innerHTML = `
                        <div class="aspect-[4/3] bg-gray-200 relative">
                            ${imgHtml}
                            <div class="absolute top-2 right-2">
                                <button onclick="event.stopPropagation(); toggleFav('${item.id}')" class="${item.fav ? 'text-red-500 fill-current' : 'text-white drop-shadow-md'}">
                                    <i data-lucide="heart" class="w-4 h-4 ${item.fav ? 'fill-red-500' : ''}"></i>
                                </button>
                            </div>
                            <div class="absolute bottom-2 left-2 bg-black/70 text-white text-[10px] px-2 py-0.5 rounded uppercase font-bold">
                                ${item.type}
                            </div>
                        </div>
                        <div class="p-3">
                            <h4 class="font-bold text-sm line-clamp-2 leading-tight">${item.title}</h4>
                            <p class="text-xs text-gray-400 mt-1">${item.folder}</p>
                        </div>
                    `;
                    grid.appendChild(div);
                });
            }

            // Render Folders
            const fContainer = document.getElementById('folder-list-container');
            fContainer.innerHTML = '';
            DATA.folders.forEach(f => {
                const count = DATA.scraps.filter(s => s.folder === f).length;
                const btn = document.createElement('button');
                btn.className = "flex flex-col items-center justify-center aspect-square bg-white border border-gray-200 rounded-lg hover:shadow-md transition";
                btn.onclick = () => { document.getElementById('search-input').value = f; currentTab='scraps'; changeTab('scraps'); render(); }; // Simple folder filter
                btn.innerHTML = `<i data-lucide="folder" class="w-8 h-8 text-yellow-400 fill-current mb-2"></i><span class="font-serif font-bold text-sm">${f}</span><span class="text-xs text-gray-400">${count}</span>`;
                fContainer.appendChild(btn);
            });

            // Update Datalist
            const dl = document.getElementById('dl-folders');
            dl.innerHTML = '';
            DATA.folders.forEach(f => {
                const opt = document.createElement('option');
                opt.value = f;
                dl.appendChild(opt);
            });

            lucide.createIcons();
        }

        // --- ACTIONS ---
        function processUrl() {
            const url = document.getElementById('inp-url').value;
            const typeSel = document.getElementById('inp-type');
            const imgInp = document.getElementById('inp-img');
            const imgPreview = document.getElementById('inp-preview');

            // Regex for YouTube
            const ytRegex = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(ytRegex);

            if (match && match[2].length === 11) {
                typeSel.value = 'video';
                // USE MQDEFAULT (16:9 No Black Bars)
                const thumb = `https://img.youtube.com/vi/${match[2]}/mqdefault.jpg`;
                imgInp.value = thumb;
                imgPreview.src = thumb;
                imgPreview.classList.remove('hidden');
            } else {
                // Assume article/image
                typeSel.value = 'news';
                imgInp.value = ''; // Reset if unknown
                imgPreview.classList.add('hidden');
            }
        }

        function updatePreview(url) {
            const img = document.getElementById('inp-preview');
            if(url) { img.src = url; img.classList.remove('hidden'); }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    document.getElementById('inp-img').value = ev.target.result;
                    updatePreview(ev.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        function saveNewItem() {
            const title = document.getElementById('inp-title').value;
            if(!title) return alert('Title is required');
            
            const folder = document.getElementById('inp-folder').value || 'General';
            if(!DATA.folders.includes(folder)) DATA.folders.push(folder);

            const newItem = {
                id: Date.now().toString(),
                url: document.getElementById('inp-url').value,
                img: document.getElementById('inp-img').value,
                title: title,
                type: document.getElementById('inp-type').value,
                folder: folder,
                memo: document.getElementById('inp-memo').value,
                fav: false
            };
            
            DATA.scraps.unshift(newItem);
            saveData();
            closeModal('add-modal');
            
            // Clear Form
            document.getElementById('inp-url').value = '';
            document.getElementById('inp-img').value = '';
            document.getElementById('inp-title').value = '';
            document.getElementById('inp-memo').value = '';
            document.getElementById('inp-preview').classList.add('hidden');
        }

        function toggleFav(id) {
            const item = DATA.scraps.find(s => s.id === id);
            if(item) { item.fav = !item.fav; saveData(); }
        }

        // --- DETAIL & EDIT ---
        function openDetail(id) {
            currentItem = DATA.scraps.find(s => s.id === id);
            if(!currentItem) return;

            const m = document.getElementById('detail-modal');
            m.classList.remove('hidden');

            document.getElementById('dt-title').value = currentItem.title;
            document.getElementById('dt-img').src = currentItem.img;
            document.getElementById('dt-link').href = currentItem.url || '#';
            document.getElementById('dt-memo').value = currentItem.memo || '';
            document.getElementById('dt-badge').innerHTML = `${currentItem.type.toUpperCase()} <i data-lucide="chevron-down" class="w-3 h-3"></i>`;
            
            lucide.createIcons();
        }

        function updateTitle(val) { if(currentItem){ currentItem.title = val; saveData(); } }
        function updateMemo(val) { if(currentItem){ currentItem.memo = val; saveData(); } }
        
        function openTypeChange() { document.getElementById('type-modal').classList.remove('hidden'); }
        function changeType(type) {
            if(currentItem) {
                currentItem.type = type;
                saveData();
                document.getElementById('dt-badge').innerHTML = `${type.toUpperCase()} <i data-lucide="chevron-down" class="w-3 h-3"></i>`;
                lucide.createIcons();
                closeModal('type-modal');
            }
        }

        function deleteCurrentItem() {
            if(confirm('Delete this item?')) {
                DATA.scraps = DATA.scraps.filter(s => s.id !== currentItem.id);
                saveData();
                closeModal('detail-modal');
            }
        }

        function addFolder() {
            const name = document.getElementById('new-folder-name').value;
            if(name && !DATA.folders.includes(name)) {
                DATA.folders.push(name);
                saveData();
                closeModal('folder-modal');
            }
        }

        function toggleFit() {
            const img = document.getElementById('dt-img');
            img.classList.toggle('img-contain');
            img.classList.toggle('img-cover');
        }

        // --- MODAL UTILS ---
        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

    </script>
</body>
</html>
